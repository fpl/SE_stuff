##### create output dir 
mkdir -p output1   output2 output3 


#########Solution 1 #########*

rm -f output1/*.txt
# Creates a txt file with the list of all uniq dates

awk -F , '{ if(NF>5) { if ($1 > 0) { print $1 }}}' ./US_*.mon | sort | uniq > output1/dates.txt

# Creates a txt file with the list of all uniq station ID, longitude, latitude. 

paste -d " " <(grep gsim.no US*.mon   | awk '{print $4}') \
             <(grep longitude US*.mon | awk '{print $4}') 
             <(grep latitude US*.mon  | awk '{print $4}') | sort -k 1,1 > output1/ID_x_y.txt

## loop trought the dates.txt 

for DATE in $(cat output1/dates.txt ) ; do 
echo processing $DATE

grep ^$DATE US*.mon | awk '{ gsub(":"," "); gsub(","," ");if($3!="NA"){print substr($1,1,10),$3}}' \
| sort -k 1,1 > output1/${DATE}_ID_mean.txt 

join -1 1 -2 1 output1/ID_x_y.txt output1/${DATE}_ID_mean.txt  > output1/${DATE}_ID_x_y_mean.txt
rm output1/${DATE}_ID_mean.txt 

done 

exit

#########Solution 2 #########

# create output dir 
mkdir -p output2/
rm -f output2/*.txt 
#loop over all US files
n=0
for i in US_*.mon ; do
#pull out information of interest
gsim=$(awk 'NR==11 {print $4}' $i)
lat=$(awk 'NR==15 {print $4}' $i)
long=$(awk 'NR==16 {print $4}' $i)
#make new directory with name of gsim ID to store txt files in
mkdir $output$gsim

#awk uses these and spits out txt files named by the date
n=$(expr $n + 1)
echo $gsim $n

awk -v gsim=$gsim -v lat=$lat -v long=$long -v output=$output \
' NR>22 {gsub(","," "); if($2!="NA"){print gsim,long,lat,$2 >> "output2/"$1"_ID_x_y_mean.txt"}}' $i

rm -r $gsim
done





#########Solution 3 #########

    awk '{gsub(",", "");
      gsub("\t", " ");
      if($2=="gsim.no")   {station=$4};
      if($2=="latitude")  {lat=$4};
      if($2=="longitude") {lon=$4};
      if($1 ~ /[0-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9]/ && $2!="NA" )
      { print station, lat , lon , $2 >  substr($1,1,7)"_nh.txt" }
      }' US_000938?.mon

    echo  "Gsim.no latitude longitude MEAN" >  header.txt  

    for file in ????-??_nh.txt ; do
    cat header.txt $file > ${file:0:7}.txt
    rm $file
    done 




    *Results*

    head output1/1880-02-29_ID_x_y_mean.txt

> US_0002566 -81.2142745 38.1381632 519.584137931034  
> US_0003205 -85.2784299 35.08677555 1607.71448275862  
> US_0003994 -90.252073 41.78058635 957.402068965517  
> US_0004107 -91.374318 40.39365535 1340.26551724138  
> US_0005298 -90.1797778 38.629 3158.30551724138  
> US_0008856 -121.1899167 45.60827778 2184.69310344828 

	head output2/1880-02-29_ID_x_y_mean.txt

> US_0002566 -81.2142745 38.1381632 519.584137931034  
> US_0003205 -85.2784299 35.08677555 1607.71448275862  
> US_0003994 -90.252073 41.78058635 957.402068965517  
> US_0004107 -91.374318 40.39365535 1340.26551724138  
> US_0005298 -90.1797778 38.629 3158.30551724138  
> US_0008856 -121.1899167 45.60827778 2184.69310344828	  


	ls   output1/*_ID_x_y_mean.txt | wc -l ## 1644
	ls   output2/*_ID_x_y_mean.txt | wc -l ## 1642
